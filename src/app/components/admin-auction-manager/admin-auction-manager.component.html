<div class="admin-auction-manager">
  <!-- Header -->
  <div class="header-section">
    <mat-card class="header-card">
      <mat-card-content>
        <div class="header-content">
          <div class="header-text">
            <h1><mat-icon>manage_accounts</mat-icon> Le tue Aste</h1>
            <p>Crea e gestisci tutte le aste fantacalcio che hai organizzato</p>
          </div>
          <div class="header-buttons">
            <button mat-raised-button color="accent" (click)="onCreateAuction()">
              <mat-icon>add_circle</mat-icon> Crea Nuova Asta
            </button>
            <button mat-raised-button color="primary" (click)="goBackToDashboard()">
              <mat-icon>dashboard</mat-icon> Torna alla Dashboard
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Content -->
  <div *ngIf="myAuctions$ | async as auctions; else loadingTemplate">
    <!-- No Auctions Card -->
    <mat-card class="no-auctions-card" *ngIf="auctions.length === 0">
      <mat-card-content>
        <mat-icon>auction</mat-icon>
        <h3>Nessuna asta creata</h3>
        <p>Inizia creando la tua prima asta fantacalcio!</p>
        <button mat-raised-button color="primary" (click)="onCreateAuction()">
          <mat-icon>add</mat-icon>
          Crea Prima Asta
        </button>
      </mat-card-content>
    </mat-card>

    <!-- Auctions Grid -->
    <div class="auctions-grid" *ngIf="auctions.length > 0">      
      <mat-card class="auction-card" 
                *ngFor="let auction of auctions" 
                [class.clickable]="auction.isAttiva && auction.partecipantiIscritti >= auction.numeroPartecipanti"
                [class.disabled-card]="!auction.isAttiva || auction.partecipantiIscritti < auction.numeroPartecipanti"
                (click)="onAuctionClick(auction)">
        <mat-card-header>
          <mat-card-title>{{ auction.nome }}</mat-card-title>
          <mat-card-subtitle>Creata il {{ auction.createdAt | date:'dd/MM/yyyy HH:mm' }}</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <div class="auction-details">
            <!-- Codice Invito -->
            <div class="detail-row">
              <span class="label">Codice Invito:</span>
              <div class="invite-code">
                <code class="code-badge">{{ auction.codiceInvito }}</code>
                <button mat-icon-button 
                        matTooltip="Copia codice invito" 
                        (click)="$event.stopPropagation()"
                        [cdkCopyToClipboard]="auction.codiceInvito">
                  <mat-icon>content_copy</mat-icon>
                </button>
              </div>
            </div>

            <!-- Partecipanti -->
            <div class="detail-row">
              <span class="label">Partecipanti:</span>
              <div class="participants-info">
                <div class="participants-text">{{ auction.partecipantiIscritti }} / {{ auction.numeroPartecipanti }}</div>
                <mat-progress-bar 
                  mode="determinate" 
                  [value]="(auction.partecipantiIscritti / auction.numeroPartecipanti) * 100">
                </mat-progress-bar>
              </div>
            </div>

            <!-- Stato -->
            <div class="detail-row">
              <span class="label">Stato:</span>
              <div class="status-chip">
                <mat-chip [color]="getStatusColor(auction)" selected>
                  {{ getStatusText(auction) }}
                </mat-chip>
              </div>
            </div>

            <!-- Messaggio di stato per la gestione -->
            <div *ngIf="!auction.isAttiva" class="warning-message">
              <mat-icon color="warn">info</mat-icon>
              <span>Attiva l'asta per permettere l'accesso alla gestione</span>
            </div>
            
            <div *ngIf="auction.isAttiva && auction.partecipantiIscritti < auction.numeroPartecipanti" class="warning-message">
              <mat-icon color="warn">group</mat-icon>
              <span>Aspetta che tutti i partecipanti si iscrivano ({{ auction.partecipantiIscritti }}/{{ auction.numeroPartecipanti }})</span>
            </div>
            
            <div *ngIf="auction.isAttiva && auction.partecipantiIscritti >= auction.numeroPartecipanti" class="success-message">
              <mat-icon color="primary">check_circle</mat-icon>
              <span>Clicca per accedere alla gestione dell'asta</span>
            </div>
          </div>
        </mat-card-content>

        <mat-card-actions>
          <div class="action-buttons">
            <!-- Download CSV (solo per aste complete) -->
            <button mat-icon-button 
                    *ngIf="auction.partecipantiIscritti >= auction.numeroPartecipanti"
                    matTooltip="Scarica CSV rose complete" 
                    color="primary"
                    (click)="onDownloadCSV(auction); $event.stopPropagation()">
              <mat-icon>download</mat-icon>
            </button>

            <!-- Azioni Stato -->
            <button mat-icon-button 
                    [matTooltip]="auction.isAttiva ? 'Disattiva asta' : 'Attiva asta'"
                    [color]="auction.isAttiva ? 'warn' : 'accent'"
                    (click)="onToggleAuctionStatus(auction); $event.stopPropagation()">
              <mat-icon>{{ auction.isAttiva ? 'pause' : 'play_arrow' }}</mat-icon>
            </button>

            <!-- Elimina -->
            <button mat-icon-button 
                    matTooltip="Elimina asta" 
                    color="warn"
                    (click)="onDeleteAuction(auction); $event.stopPropagation()">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>

<!-- Loading Template -->
<ng-template #loadingTemplate>
  <mat-card>
    <mat-card-content style="text-align: center; padding: 40px;">
      <mat-spinner diameter="40"></mat-spinner>
      <p style="margin-top: 16px; color: #666;">Caricamento aste...</p>
    </mat-card-content>
  </mat-card>
</ng-template>
